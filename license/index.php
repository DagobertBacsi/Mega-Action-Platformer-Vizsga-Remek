<?php 
// Include the configuration file  
require_once 'config.php'; 
?>

<script src="https://www.paypal.com/sdk/js?client-id=<?php echo PAYPAL_SANDBOX?PAYPAL_SANDBOX_CLIENT_ID:PAYPAL_PROD_CLIENT_ID; ?>&currency=<?php echo $currency; ?>"></script>
<link rel="stylesheet" href="paypal.css">

<div class="rgb-bg">
<div class="terms-container">
    <h3>üí° √Åltal√°nos Szerz≈ëd√©si Felt√©telek (√ÅSZF) üí°</h3>
    <textarea readonly class="terms-text">
                    üìù **Hat√°lyos: 2024. m√°rcius 2.**  

K√©rj√ºk, figyelmesen olvassa el az al√°bbi szerz≈ëd√©si felt√©teleket,  
miel≈ëtt PayPal-on kereszt√ºl fizet√©st hajt v√©gre.  

A **PayPal gombra kattint√°ssal** √©s a tranzakci√≥ elind√≠t√°s√°val  
√ñn elfogadja a jelen √ÅSZF-et.  

-------------------------------------------------------  

1Ô∏è‚É£ **Fizet√©si folyamat**  
   A fizet√©s a **PayPal biztons√°gos rendszer√©n** kereszt√ºl t√∂rt√©nik.  
   A V√°s√°rl√≥ **e-mailben kap visszaigazol√°st**.  

2Ô∏è‚É£ **Term√©kek √©s √°rak**  
   - A felt√ºntetett √°rak **tartalmazz√°k az ad√≥kat** (ha van).  
   - Az √°rak **v√©glegesek**.  

3Ô∏è‚É£ **Sz√°ll√≠t√°s √©s teljes√≠t√©s**  
   - üì• **Digit√°lis term√©kek**: azonnal el√©rhet≈ëv√© v√°lnak.  
   - üì¶ **Fizikai term√©kek**: a sz√°ll√≠t√°s a megrendel√©st≈ël f√ºgg.  

4Ô∏è‚É£ **El√°ll√°si jog**  
   - ‚ùå **Digit√°lis term√©kek**: nincs visszat√©r√≠t√©s.  
   - ‚úÖ **Fizikai term√©kek**: 14 napon bel√ºl √©lhet az el√°ll√°si jog√°val.  

5Ô∏è‚É£ **Adatkezel√©s √©s biztons√°g**  
   A V√°s√°rl√≥ adatait az **Adatv√©delmi Szab√°lyzat** szerint kezelj√ºk.  

-------------------------------------------------------  

üîπ **√úgyf√©lszolg√°lat**  
üìß **E-mail**: chetan@mapdevelopment.hu  
üìû **Telefon**: 06702587769  
    </textarea>
    
    <label class="checkbox-container">
        <input type="checkbox" id="acceptTerms"> Elfogadom az √ÅSZF-et
        <span class="checkmark"></span>
    </label>
    
    <button id="acceptButton" disabled>‚úÖ Elfogadom</button>
</div>


    <!-- Fizet√©si fel√ºlet (kezdetben rejtve) -->
    <div id="paymentSection" class="hidden">
        <div class="panel">
            <div class="overlay hidden">
                <div class="overlay-content">
                    <img src="css/loading.gif" alt="Processing..."/>
                </div>
            </div>

            <div class="panel-heading">
                <h3 class="panel-title">üí∞ <?php echo '$'.$itemPrice; ?> Fizet√©se PayPal Haszn√°lat√°val üí∞</h3>
                
                <!-- Term√©k Inform√°ci√≥ -->
                <p><b>üõç Term√©k Neve:</b> <?php echo $itemName; ?></p>
                <p><b>üí≤ √År:</b> <?php echo '$'.$itemPrice.' '.$currency; ?></p>
            </div>
            <div class="panel-body">
                <!-- Visszajelz√©s -->
                <div id="paymentResponse" class="hidden"></div>
                
                <!-- PayPal gomb -->
                <div id="paypal-button-container"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const acceptCheckbox = document.getElementById("acceptTerms");
    const acceptButton = document.getElementById("acceptButton");
    const paymentSection = document.getElementById("paymentSection");

    // Gomb enged√©lyez√©se ha a checkbox be van pip√°lva
    acceptCheckbox.addEventListener("change", function() {
        acceptButton.disabled = !this.checked;
    });

    // Fizet√©si fel√ºlet megjelen√≠t√©se az √ÅSZF elfogad√°sa ut√°n
    acceptButton.addEventListener("click", function() {
        paymentSection.classList.remove("hidden");
        document.querySelector(".terms-container").classList.add("hidden");
    });
});

paypal.Buttons({
    createOrder: (data, actions) => {
        return actions.order.create({
            "purchase_units": [{
                "custom_id": "<?php echo $itemNumber; ?>",
                "description": "<?php echo $itemName; ?>",
                "amount": {
                    "currency_code": "<?php echo $currency; ?>",
                    "value": <?php echo $itemPrice; ?>
                }
            }]
        });
    },
    onApprove: (data, actions) => {
        return actions.order.capture().then(function(orderData) {
            setProcessing(true);

            var postData = {paypal_order_check: 1, order_id: orderData.id};
            fetch('paypal_checkout_validate.php', {
                method: 'POST',
                headers: {'Accept': 'application/json'},
                body: encodeFormData(postData)
            })
            .then((response) => response.json())
            .then((result) => {
                if(result.status == 1){
                    window.location.href = "payment-status.php?checkout_ref_id="+result.ref_id;
                } else {
                    const messageContainer = document.querySelector("#paymentResponse");
                    messageContainer.classList.remove("hidden");
                    messageContainer.textContent = result.msg;
                    setTimeout(() => messageContainer.classList.add("hidden"), 5000);
                }
                setProcessing(false);
            })
            .catch(error => console.log(error));
        });
    }
}).render('#paypal-button-container');

const encodeFormData = (data) => {
    var form_data = new FormData();
    for (var key in data) {
        form_data.append(key, data[key]);
    }
    return form_data;
}

const setProcessing = (isProcessing) => {
    document.querySelector(".overlay").classList.toggle("hidden", !isProcessing);
}
</script>

<style>
/* RGB h√°tt√©r */
.rgb-bg {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(270deg, #ff0000, #00ff00, #0000ff);
    background-size: 600% 600%;
    animation: rgbAnimation 10s infinite alternate;
}

/* RGB anim√°ci√≥ */
@keyframes rgbAnimation {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}


.terms-container {
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    width: 90%;
    max-width: 600px;
}


.terms-text {
    width: 100%;
    height: 350px;
    padding: 10px;
    background: #222;
    color: #0f0;
    border: 1px solid #0f0;
    resize: none;
}


#acceptButton {
    margin-top: 10px;
    padding: 10px 20px;
    background: yellow;
    color: black;
    cursor: pointer;
    border-radius: 5px;
}

.hidden {
    display: none;
}
</style>
